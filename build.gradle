plugins {
	id "org.flywaydb.flyway" version "5.2.4"
}
ext {
	flyway = [
		url: 'jdbc:postgresql://localhost:5430/wishDream',
		user: 'wishDream',
		password: 'nana',
		driver: 'org.postgresql.Driver',
		schemas: 'public'
	]
}


allprojects {
	apply plugin: 'java'
	apply plugin: 'org.flywaydb.flyway'
	
	group 'kr.co.wishDream'
	version '0.0.1-SNAPSHOT'
	
	sourceCompatibility = 1.8
	targetCompatibility = 1.8
	
	compileJava {
	   sourceCompatibility = 1.8
	   targetCompatibility = 1.8
	}
	
	[compileJava, compileTestJava]*.options*.encoding = 'UTF-8'
}

subprojects {
	apply plugin: 'idea'
	
	sourceSets {
	    main {
	        java {
	            srcDirs = ['src/main/java']
	            java.outputDir = file('out/main')
	            output.resourcesDir = file('out/main')
	        }
	        resources {
	            srcDirs = ['src/main/resources']
	        }
	    }
	    test {
	    	java {
	    		srcDirs = ['src/test/java']
	    	}
	    	resources {
	    		srcDirs = ['src/test/resources']
	    	}
	    }
	}
	
	repositories {
		jcenter()
		mavenCentral()
	}
	
	
	
	
	dependencies {
		implementation 'org.springframework.boot:spring-boot-starter-webflux'
		implementation "io.reactivex.rxjava3:rxjava:3.0.0-RC1"
		// database
		compile group: 'com.github.davidmoten', name: 'rxjava2-jdbc', version: '0.2.4'
		compile group: 'org.postgresql', name: 'postgresql', version: '42.2.5'
		
		compile('org.springframework.boot:spring-boot-starter-thymeleaf')
		compileOnly 'org.projectlombok:lombok'
		annotationProcessor 'org.projectlombok:lombok'
		testCompileOnly 'org.projectlombok:lombok'
		testAnnotationProcessor 'org.projectlombok:lombok'
		
		annotationProcessor 'org.projectlombok:lombok'
		testImplementation 'org.springframework.boot:spring-boot-starter-test'
		testImplementation 'io.projectreactor:reactor-test'
	}
	
	jar {
        manifest.attributes provider: 'gradle'
        version = '0.0.1'
    }
    
}



task run {
	println "java-version : ${sourceCompatibility}"
    println "project-version : ${version}"
	println "======== All project cleaning start ========"
	dependsOn gradle.includedBuilds*.task(':clean')
	println "========  All project cleaned done  ========"
	println "======== All project building start ========"
    dependsOn gradle.includedBuilds*.task(':build')
    println "========  All project builded done  ========"
}

defaultTasks('run')
